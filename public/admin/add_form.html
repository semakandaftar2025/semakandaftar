<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="/style.css">
    <title>Sistem Semakan Daftar Peguam Syarie Negeri Perlis</title>
</head>
<body class="body-new">
    <nav class="nav">
        <div class="nav-left">
            <div class="nav-logo">
                <img src="/images/jata perlis.png" alt="Jata Perlis" class="logo-img" />              </div>                  
        </div>
        
        <div class="nav-center">
                        
        </div>
        
        <div class="nav-right">
            <img src="/images/logo sistem.png" alt="Logo Sistem" class="logo-img" />     
        </div>
</nav>
<div class="form-wrapper">
    <div class="line-1">
        <h1>Pendaftaran Peguam Baru</h1>
        <button class="close-form">X</button>
    </div>
    <form id="myform">
        <div class="line-2">
            <div class="add-form">
                <span class="title">Butiran Peribadi</span>
                <div class="fields">
                    <div class="input-fields">
                        <label>Nama Penuh (*)</label>
                        <input type="text" id="nama" placeholder="Masukkan nama" required>
                    </div>
                    <div class="input-fields">
                        <label>No. Kad Pengenalan (*)</label>
                        <input type="text" id="icNum" placeholder="Masukkan IC (tanpa -)" required>
                    </div>
                    <div class="input-fields">
                        <label>No. Telefon (B) (*)</label>
                        <input type="text" id="noTel" placeholder="Masukkan no. telefon bimbit">
                    </div>
                </div>
                <div class="fields">
                    <div class="input-fields">
                        <label>Alamat Rumah (*)</label>
                        <input type="text" id="alamat" placeholder="Masukkan alamat penuh" required>
                    </div>
                    <div class="input-fields">
                        <label>Emel (*)</label>
                        <input type="text" id="emel" placeholder="Masukkan emel">
                    </div>
                </div>
            
                <span class="title">Maklumat Akademik</span>
                <div class="fields">
                    <div class="input-fields">
                        <label>Kelulusan Akademik</label>
                        <input type="text" id="kelulusan" placeholder="Masukkan kelulusan akademik">
                    </div>
                </div>
            
                <span class="title">Maklumat Firma</span>
                <div class="fields">
                    <div class="input-fields">
                        <label>Nama Firma (*)</label>
                        <input type="text" id="namaFirma" placeholder="Masukkan nama firma" required>
                    </div>
                    <div class="input-fields">
                        <label>No. Pendaftaran Firma (*)</label>
                        <input type="text" id="noPendaftaranFirma" placeholder="Masukkan no. pendaftaran firma">
                    </div>
                </div>
                <div class="fields">
                    <div class="input-fields">
                        <label>Alamat Firma</label>
                        <input type="text" id="alamatFirma" placeholder="Masukkan alamat firma">
                    </div>
                    <div class="input-fields">
                        <label>Alamat Cawangan</label>
                        <input type="text" id="alamatCawangan" placeholder="Masukkan alamat cawangan">
                    </div>
                    <div class="input-fields">
                        <label>Alamat Firma (Ibu Pejabat)</label>
                        <input type="text" id="alamatFirmaIbuPejabat" placeholder="Masukkan alamat ibu pejabat">
                    </div>
                </div>
            
                <span class="title">Maklumat Perhubungan</span>
                <div class="fields">
                    <div class="input-fields">
                        <label>No. Telefon (P)</label>
                        <input type="text" id="noTelPejabat" placeholder="Masukkan no. telefon pejabat">
                    </div>
                    <div class="input-fields">
                        <label>No. Fax (P)</label>
                        <input type="text" id="noFax" placeholder="Masukkan no. fax pejabat">
                    </div>
                    <div class="input-fields">
                        <label>Emel Firma</label>
                        <input type="text" id="emelFirma" placeholder="Masukkan emel firma">
                    </div>
                </div>
            
                <span class="title">Maklumat Amalan</span>
                <div class="fields">
                    <div class="input-fields">
                        <label>Tarikh Diterima Masuk</label>
                        <input type="date" id="tarikhDiterima" placeholder="Masukkan tarikh diterima masuk">
                    </div>
                    <div class="input-fields">
                        <label>Tempoh Sah Sijil Amalan</label>
                        <input type="date" id="tempohSijilAmalan" placeholder="Masukkan tempoh sah">
                    </div>
                    <div class="input-fields">
                        <label>Tarikh Pembatalan</label>
                        <input type="date" id="tarikhBatal" placeholder="Masukkan tarikh pembatalan">
                    </div>
                </div>
            
                <span class="title">Maklumat Lain</span>
                <div class="fields">
                    <div class="input-fields">
                        <label>Maklumat Tindakan Tatatertib (JIKA ADA)</label>
                        <select id="tindakanTatatertib">
                            <option value="">-- Pilih --</option>
                            <option value="Denda">Denda</option>
                        </select>
                    </div>
                    <div class="input-fields">
                        <label>Butiran Lain</label>
                        <input type="text" id="butiranLain" placeholder="Masukkan butiran tambahan">
                    </div>
                    <div class="input-fields">
                        <label>Link Gambar Passport</label>
                        <input type="text" id="linkGmbr" placeholder="Masukkan link gambar passport">
                    </div>
                </div>
                <div class="fields">
                    <div class="input-fields">
                        <label>No Resit</label>
                        <input type="number" id="noResit" placeholder="Masukkan nombor resit">
                    </div>
                    <div class="input-fields">
                        <label>No Siri Daftar</label>
                        <input type="text" id="noSiriDaftar" placeholder="Masukkan nombor siri daftar">
                    </div>
                    <div class="input-fields">
                        <label>Status</label>
                        <select id="status" required>
                            <option value="menunggu">Menunggu Keputusan</option>
                            <option value="aktif">Aktif</option>
                            <option value="tidakaktif">Tidak Aktif</option>
                            <option value="lulus">Lulus</option>
                            <option value="gagal">Gagal</option>
                        </select>                    
                    </div>
                </div>
            </div>
            
            <button type="submit" id="hantarBtn" class="submit-form">Hantar</button>
        </div>
    </form>
</div>
<script>
    
    // Close the form
    document.querySelector(".close-form").addEventListener("click", () => {
    history.back();
    });
</script>

<script>
    window.addEventListener("load", function () {
      document.body.classList.add("loaded");
    });
  </script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBGo7VyWereRHO4UBXn8VH2z56HUzGoAkM",
        authDomain: "semakan-daftar-c9267.firebaseapp.com",
        projectId: "semakan-daftar-c9267",
        storageBucket: "semakan-daftar-c9267.appspot.com",
        messagingSenderId: "1090274861346",
        appId: "1:1090274861346:web:a54aef11652f8dcd82057b"
    };

    // Initialize firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

  onAuthStateChanged(auth, (user) => {
    if (user && user.email === "semakandaftarpeguamsyarie2025@gmail.com") {
      // ✅ Admin is logged in, continue
      console.log("Admin authenticated");
    } else {
      // ❌ Not logged in or not admin
      alert("Please log in to access the admin page.");
      window.location.replace("login.html");
    }
  });

  // ✅ Function to generate a unique 8-digit ID
async function generateUniqueID(length = 8) {
  const digits = '0123456789';
  let isUnique = false;
  let id;

  while (!isUnique) {
    id = '';
    for (let i = 0; i < length; i++) {
      id += digits.charAt(Math.floor(Math.random() * digits.length));
    }

    const q = query(collection(db, "peguamsyarie"), where("id", "==", id));
    const querySnapshot = await getDocs(q);

    if (querySnapshot.empty) {
      isUnique = true;
    }
  }

  return id;
}

// Handle "Hantar" button click
// document.getElementById('hantarBtn').addEventListener('click', async function(e) {
// Submit Form
    document.getElementById("myform").addEventListener("submit", async function (e) {
      e.preventDefault();

      const hantarBtn = document.getElementById("hantarBtn");
      hantarBtn.disabled = true;
      hantarBtn.textContent = "Sedang Hantar...";
      hantarBtn.style.backgroundColor = "#a5b0a6";

      const noID = await generateUniqueID();
      const formData = {
        id: noID,
        nama: document.getElementById('nama').value,
        icNum: document.getElementById('icNum').value,
        noTel: document.getElementById('noTel').value,
        alamat: document.getElementById('alamat').value,
        emel: document.getElementById('emel').value,
        kelulusan: document.getElementById('kelulusan').value,
        namaFirma: document.getElementById('namaFirma').value,
        noPendaftaranFirma: document.getElementById('noPendaftaranFirma').value,
        alamatFirma: document.getElementById('alamatFirma').value,
        alamatCawangan: document.getElementById('alamatCawangan').value,
        alamatFirmaIbuPejabat: document.getElementById('alamatFirmaIbuPejabat').value,
        noTelPejabat: document.getElementById('noTelPejabat').value,
        noFax: document.getElementById('noFax').value,
        emelFirma: document.getElementById('emelFirma').value,
        tarikhDiterima: document.getElementById('tarikhDiterima').value,
        tempohSijilAmalan: document.getElementById('tempohSijilAmalan').value,
        tarikhBatal: document.getElementById('tarikhBatal').value,
        infoTatatertib: document.getElementById('tindakanTatatertib').value,
        butiranLain: document.getElementById('butiranLain').value,
        linkGmbr: document.getElementById('linkGmbr').value,
        noResit: document.getElementById('noResit').value,
        noSiriDaftar: document.getElementById('noSiriDaftar').value,
        status: document.getElementById('status').value,
        createdAt: new Date().toISOString()
      };

      try {
        const docRef = await addDoc(collection(db, "peguamsyarie"), formData);
        alert("✅ Maklumat berjaya dihantar! ID: " + noID);
        document.getElementById("myform").reset();
      } catch (error) {
        console.error("❌ Ralat semasa menghantar data:", error);
        alert("❌ Gagal menghantar maklumat: " + error.message);
      } finally {
      // Enable the button again regardless of success or failure
      hantarBtn.disabled = false;
      hantarBtn.textContent = "Hantar";
      hantarBtn.style.backgroundColor = "#4CAF50";
    }
    });
</script>

</body>
</html>