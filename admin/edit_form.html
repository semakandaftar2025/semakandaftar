<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="/style.css">
    <title>Sistem Semakan Daftar Peguam Syarie Negeri Perlis</title>
</head>
<body class="body-new">
    <nav class="nav">
        <div class="nav-left">
            <div class="nav-logo">
                <img src="/images/jata negara.png" alt="Jata Negara" class="logo-img">
                <img src="/images/jata perlis.png" alt="Jata Perlis" class="logo-img">
                <img src="/images/jksnps logo.png" alt="Logo JKSNPs" class="logo-img">
              </div>                  
        </div>
        
        <div class="nav-center">
                        
        </div>
        
        <div class="nav-right">
            <img src="/images/logo sistem.png" alt="Logo Sistem" class="logo-img" />     
        </div>
</nav>
<div class="form-wrapper">
    <div class="line-1">
        <h1>Edit Maklumat</h1>
        <button class="close-edit-form">X</button>
    </div>
    <form id="updateForm">
        <div class="line-2">
            <div class="add-form">
                <span class="title">Butiran Peribadi</span>
                <div class="fields">
                    <div class="input-fields">
                        <label>Nama Penuh</label>
                        <input type="text" id="nama" placeholder="Masukkan nama" required>
                    </div>
                    <div class="input-fields">
                        <label>No. Kad Pengenalan (*)</label>
                        <input type="text" id="icNum" placeholder="Masukkan IC (tanpa -)" required>
                    </div>
                    <div class="input-fields">
                        <label>No. Telefon (B) (*)</label>
                        <input type="text" id="noTel" placeholder="Masukkan no. telefon bimbit" required>
                    </div>
                </div>
                <div class="fields">
                    <div class="input-fields">
                        <label>Alamat Rumah (*)</label>
                        <input type="text" id="alamat" placeholder="Masukkan alamat penuh" required>
                    </div>
                    <div class="input-fields">
                        <label>Emel (*)</label>
                        <input type="text" id="emel" placeholder="Masukkan emel" required>
                    </div>
                </div>
            
                <span class="title">Maklumat Akademik</span>
                <div class="fields">
                    <div class="input-fields">
                        <label>Kelulusan Akademik</label>
                        <input type="text" id="kelulusan" placeholder="Masukkan kelulusan akademik" required>
                    </div>
                </div>
            
                <span class="title">Maklumat Firma</span>
                <div class="fields">
                    <div class="input-fields">
                        <label>Nama Firma (*)</label>
                        <input type="text" id="namaFirma" placeholder="Masukkan nama firma" required>
                    </div>
                    <div class="input-fields">
                        <label>No. Pendaftaran Firma (*)</label>
                        <input type="text" id="noPendaftaranFirma" placeholder="Masukkan no. pendaftaran firma" required>
                    </div>
                </div>
                <div class="fields">
                    <div class="input-fields">
                        <label>Alamat Firma</label>
                        <input type="text" id="alamatFirma" placeholder="Masukkan alamat firma"required>
                    </div>
                    <div class="input-fields">
                        <label>Alamat Cawangan</label>
                        <input type="text" id="alamatCawangan" placeholder="Masukkan alamat cawangan" required>
                    </div>
                    <div class="input-fields">
                        <label>Alamat Firma (Ibu Pejabat)</label>
                        <input type="text" id="alamatFirmaIbuPejabat" placeholder="Masukkan alamat ibu pejabat" required>
                    </div>
                </div>
            
                <span class="title">Maklumat Perhubungan</span>
                <div class="fields">
                    <div class="input-fields">
                        <label>No. Telefon (P)</label>
                        <input type="text" id="noTelPejabat" placeholder="Masukkan no. telefon pejabat" required>
                    </div>
                    <div class="input-fields">
                        <label>No. Fax (P)</label>
                        <input type="text" id="noFax" placeholder="Masukkan no. fax pejabat" required>
                    </div>
                    <div class="input-fields">
                        <label>Emel Firma</label>
                        <input type="text" id="emelFirma" placeholder="Masukkan emel firma" required>
                    </div>
                </div>
            
                <span class="title">Maklumat Amalan</span>
                <div class="fields">
                    <div class="input-fields">
                        <label>Tarikh Diterima Masuk</label>
                        <input type="date" id="tarikhDiterima" placeholder="Masukkan tarikh diterima masuk" required>
                    </div>
                    <div class="input-fields">
                        <label>Tempoh Sah Sijil Amalan</label>
                        <input type="date" id="tempohSijilAmalan" placeholder="Masukkan tempoh sah" required>
                    </div>
                    <div class="input-fields">
                        <label>Tarikh Pembatalan</label>
                        <input type="date" id="tarikhBatal" placeholder="Masukkan tarikh pembatalan" required>
                    </div>
                </div>
            
                <span class="title">Maklumat Lain</span>
                <div class="fields">
                    <div class="input-fields">
                        <label>Maklumat Tindakan Tatatertib (JIKA ADA)</label>
                        <select id="tindakanTatatertib">
                            <option value="">-- Pilih --</option>
                            <option value="Denda">Denda</option>
                        </select>
                    </div>
                    <div class="input-fields">
                        <label>Butiran Lain</label>
                        <input type="text" id="butiranLain" placeholder="Masukkan butiran tambahan" required>
                    </div>
                    <div class="input-fields">
                        <label>Link Gambar Passport</label>
                        <input type="text" id="linkGmbr" placeholder="Masukkan link gambar passport" required>
                    </div>
                </div>
                <div class="fields">
                    <div class="input-fields">
                        <label>No Resit</label>
                        <input type="number" id="noResit" placeholder="Masukkan nombor resit" required>
                    </div>
                    <div class="input-fields">
                        <label>No Siri Daftar</label>
                        <input type="text" id="noSiriDaftar" placeholder="Masukkan nombor siri daftar" required>
                    </div>
                    <div class="input-fields">
                        <label>Status</label>
                        <select id="status" required>
                            <option value="menunggu">Menunggu Keputusan</option>
                            <option value="lulus">Lulus</option>
                            <option value="gagal">Gagal</option>
                        </select>                    
                    </div>
                </div>
            </div>
            
            <button type="submit" id="saveBtn" class="save-form">Simpan</button>
        </div>
    </form>
</div>

<!-- Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.0/firebase-app.js";
  import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.8.0/firebase-firestore.js";

  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyBGo7VyWereRHO4UBXn8VH2z56HUzGoAkM",
    authDomain: "semakan-daftar-c9267.firebaseapp.com",
    projectId: "semakan-daftar-c9267",
    storageBucket: "semakan-daftar-c9267.appspot.com",
    messagingSenderId: "1090274861346",
    appId: "1:1090274861346:web:a54aef11652f8dcd82057b"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Get docId from URL
  const params = new URLSearchParams(window.location.search);
  const docId = params.get("docId");

  async function fillFormData(docId) {
    if (!docId) return alert("docId not found in URL!");

    try {
      const docRef = doc(db, "peguamsyarie", docId);
      const docSnap = await getDoc(docRef);

      if (docSnap.exists()) {
        const data = docSnap.data();

        // Fill form fields
        document.getElementById("nama").value = data.nama || "";
        document.getElementById("icNum").value = data.icNum || "";
        document.getElementById("noTel").value = data.noTel || "";
        document.getElementById("alamat").value = data.alamat || "";
        document.getElementById("emel").value = data.emel || "";
        document.getElementById("kelulusan").value = data.kelulusan || "";
        document.getElementById("namaFirma").value = data.namaFirma || "";
        document.getElementById("noPendaftaranFirma").value = data.noPendaftaranFirma || "";
        document.getElementById("alamatFirma").value = data.alamatFirma || "";
        document.getElementById("alamatCawangan").value = data.alamatCawangan || "";
        document.getElementById("alamatFirmaIbuPejabat").value = data.alamatFirmaIbuPejabat || "";
        document.getElementById("noTelPejabat").value = data.noTelPejabat || "";
        document.getElementById("noFax").value = data.noFax || "";
        document.getElementById("emelFirma").value = data.emelFirma || "";
        document.getElementById("tarikhDiterima").value = data.tarikhDiterima || "";
        document.getElementById("tempohSijilAmalan").value = data.tempohSijilAmalan || "";
        document.getElementById("tarikhBatal").value = data.tarikhBatal || "";
        document.getElementById("tindakanTatatertib").value = data.tindakanTatatertib || "";
        document.getElementById("butiranLain").value = data.butiranLain || "";
        document.getElementById("linkGmbr").value = data.linkGmbr || "";
        document.getElementById("noResit").value = data.noResit || "";
        document.getElementById("noSiriDaftar").value = data.noSiriDaftar || "";
        document.getElementById("status").value = data.status || "";

      } else {
        alert("No such document!");
      }
    } catch (err) {
      console.error("Error getting document:", err);
      alert("Error loading data!");
    }
  }

  async function updateFormData(event) {
    event.preventDefault(); // Prevent form submission

    try {
      const docRef = doc(db, "peguamsyarie", docId);

      // Get values from form
      await updateDoc(docRef, {
        nama: document.getElementById("nama").value,
        icNum: document.getElementById("icNum").value,
        noTel: document.getElementById("noTel").value,
        alamat: document.getElementById("alamat").value,
        emel: document.getElementById("emel").value,
        kelulusan: document.getElementById("kelulusan").value,
        namaFirma: document.getElementById("namaFirma").value,
        noPendaftaranFirma: document.getElementById("noPendaftaranFirma").value,
        alamatFirma: document.getElementById("alamatFirma").value,
        alamatCawangan: document.getElementById("alamatCawangan").value,
        alamatFirmaIbuPejabat: document.getElementById("alamatFirmaIbuPejabat").value,
        noTelPejabat: document.getElementById("noTelPejabat").value,
        noFax: document.getElementById("noFax").value,
        emelFirma: document.getElementById("emelFirma").value,
        tarikhDiterima: document.getElementById("tarikhDiterima").value,
        tempohSijilAmalan: document.getElementById("tempohSijilAmalan").value,
        tarikhBatal: document.getElementById("tarikhBatal").value,
        tindakanTatatertib: document.getElementById("tindakanTatatertib").value,
        butiranLain: document.getElementById("butiranLain").value,
        linkGmbr: document.getElementById("linkGmbr").value,
        noResit: document.getElementById("noResit").value,
        noSiriDaftar: document.getElementById("noSiriDaftar").value,
        status: document.getElementById("status").value
      });

      alert("Data updated successfully!");
      window.location.href = "admin_semakan.html";
    } catch (err) {
      console.error("Error updating document:", err);
      alert("Failed to update data!");
    }
  }

  // Run on page load
  fillFormData(docId);

  // Handle form submission
  document.getElementById("updateForm").addEventListener("submit", updateFormData);

  // Close the form
  document.querySelector(".close-edit-form").addEventListener("click", () => {
  history.back();
  });
</script>

</body>
</html>